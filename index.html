<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Potato Hero - Brotato Style Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rubik:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Reset e configurações gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        :root {
            --primary: #FF6B35;
            --secondary: #00C2D1;
            --accent: #FFD166;
            --dark: #0A1128;
            --darker: #060A1A;
            --light: #F8F9FA;
            --success: #06D6A0;
            --danger: #EF476F;
            --warning: #FFD166;
        }

        body {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: fixed;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Container principal do jogo */
        .game-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Tela de carregamento/boas-vindas */
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .logo {
            font-family: 'Press Start 2P', cursive;
            font-size: 3.5rem;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.7);
            margin-bottom: 2rem;
            text-align: center;
            line-height: 1.2;
        }

        .logo span {
            color: var(--accent);
            display: block;
            font-size: 2rem;
            margin-top: 0.5rem;
        }

        .loading-bar-container {
            width: 80%;
            max-width: 400px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 2rem 0;
        }

        .loading-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--accent);
            margin-top: 1rem;
        }

        .platform-select {
            display: flex;
            gap: 20px;
            margin-top: 2rem;
        }

        .platform-btn {
            padding: 15px 30px;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--primary), #FF8B5A);
            color: white;
            font-size: 1.2rem;
            border: none;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Press Start 2P', cursive;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .platform-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .platform-btn.mobile {
            background: linear-gradient(135deg, var(--secondary), #2CE0EF);
        }

        /* Interface principal do jogo */
        .game-ui {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            position: relative;
        }

        /* Barra superior de informações */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(to bottom, rgba(10, 17, 40, 0.9), rgba(6, 10, 26, 0.7));
            border-bottom: 3px solid var(--primary);
            backdrop-filter: blur(5px);
            z-index: 100;
            flex-shrink: 0;
        }

        .game-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            color: var(--primary);
            text-shadow: 2px 2px 0 #000;
        }

        .stats-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 100px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            color: var(--accent);
            font-size: 1.1rem;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--light);
        }

        .wave-info {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(0, 194, 209, 0.2));
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--primary);
        }

        .wave-text {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            color: var(--accent);
        }

        .wave-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--light);
            margin-top: 5px;
        }

        /* Área do jogo */
        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 194, 209, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(255, 107, 53, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 40% 80%, rgba(255, 209, 102, 0.1) 0%, transparent 20%);
        }

        .game-canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: -moz-crisp-edges;
            image-rendering: pixelated;
        }

        /* Controles para mobile */
        .mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 20px;
            display: none;
            z-index: 50;
            justify-content: space-between;
            pointer-events: none;
        }

        .joystick-container {
            width: 140px;
            height: 140px;
            position: relative;
            pointer-events: auto;
        }

        .joystick-base {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 70%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }

        .joystick {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, var(--primary) 0%, #FF8B5A 100%);
            border-radius: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: flex-end;
            pointer-events: auto;
        }

        .action-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--secondary) 0%, #2CE0EF 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 5px 15px rgba(0, 194, 209, 0.5);
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .action-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(0, 194, 209, 0.3);
        }

        .action-btn.special {
            background: radial-gradient(circle, var(--accent) 0%, #FFE082 100%);
            box-shadow: 0 5px 15px rgba(255, 209, 102, 0.5);
        }

        /* Menu de upgrades entre ondas */
        .upgrade-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(6, 10, 26, 0.95) 0%, rgba(10, 17, 40, 0.98) 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            backdrop-filter: blur(5px);
        }

        .upgrade-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 209, 102, 0.5);
        }

        .upgrade-subtitle {
            font-size: 1.2rem;
            color: var(--light);
            margin-bottom: 2rem;
            text-align: center;
            opacity: 0.8;
        }

        .upgrade-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1000px;
            width: 90%;
            margin: 2rem 0;
        }

        .upgrade-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .upgrade-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.2);
        }

        .upgrade-card.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(255, 209, 102, 0.1), rgba(255, 209, 102, 0.05));
            box-shadow: 0 10px 25px rgba(255, 209, 102, 0.3);
        }

        .upgrade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .upgrade-name {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .upgrade-rarity {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .rarity-common { background-color: rgba(255, 255, 255, 0.1); color: var(--light); }
        .rarity-uncommon { background-color: rgba(0, 194, 209, 0.2); color: var(--secondary); }
        .rarity-rare { background-color: rgba(255, 107, 53, 0.2); color: var(--primary); }
        .rarity-epic { background-color: rgba(155, 89, 182, 0.2); color: #9B59B6; }
        .rarity-legendary { background-color: rgba(255, 209, 102, 0.2); color: var(--accent); }

        .upgrade-description {
            color: var(--light);
            opacity: 0.9;
            line-height: 1.5;
            flex-grow: 1;
        }

        .upgrade-stats {
            display: flex;
            justify-content: space-between;
            color: var(--accent);
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 10px;
        }

        .upgrade-confirm {
            padding: 15px 40px;
            background: linear-gradient(135deg, var(--success), #06F7B4);
            color: var(--dark);
            border: none;
            border-radius: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 2rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .upgrade-confirm:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(6, 214, 160, 0.3);
        }

        /* Tela de game over */
        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(239, 71, 111, 0.9) 0%, rgba(6, 10, 26, 0.95) 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
            backdrop-filter: blur(5px);
        }

        .game-over-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 3.5rem;
            color: var(--light);
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .game-over-stats {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            margin: 2rem 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: var(--accent);
        }

        .stat-value-large {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--light);
        }

        .restart-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, var(--primary), #FF8B5A);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 2rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 53, 0.3);
        }

        /* Controles de teclado para PC */
        .pc-hint {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            max-width: 300px;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hint-title {
            color: var(--accent);
            margin-bottom: 10px;
            font-weight: bold;
        }

        .hint-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .logo {
                font-size: 2.5rem;
            }
            
            .logo span {
                font-size: 1.5rem;
            }
            
            .top-bar {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
            
            .stats-container {
                width: 100%;
                justify-content: space-between;
            }
            
            .stat-box {
                min-width: 80px;
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .wave-info {
                width: 100%;
                margin-top: 10px;
            }
            
            .mobile-controls {
                display: flex;
            }
            
            .pc-hint {
                display: none !important;
            }
            
            .upgrade-options {
                grid-template-columns: 1fr;
            }
            
            .upgrade-title {
                font-size: 1.8rem;
            }
        }

        @media (min-width: 769px) {
            .pc-hint {
                display: block;
            }
        }

        /* Animações */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .float-animation {
            animation: float 3s infinite ease-in-out;
        }

        .pulse-animation {
            animation: pulse 2s infinite ease-in-out;
        }

        .shake-animation {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <!-- Tela de carregamento inicial -->
    <div class="loading-screen" id="loadingScreen">
        <div class="logo">POTATO<span>HERO</span></div>
        <div class="loading-bar-container">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
        <div class="loading-text" id="loadingText">Carregando recursos do jogo...</div>
        
        <div class="platform-select">
            <button class="platform-btn mobile" id="mobileMode">
                <i class="fas fa-mobile-alt"></i> Mobile
            </button>
            <button class="platform-btn" id="pcMode">
                <i class="fas fa-desktop"></i> PC
            </button>
        </div>
    </div>

    <!-- Interface principal do jogo -->
    <div class="game-ui" id="gameUI">
        <!-- Barra superior -->
        <div class="top-bar">
            <div class="game-title">POTATO HERO</div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <i class="fas fa-heartbeat stat-icon"></i>
                    <div>
                        <div>SAÚDE</div>
                        <div class="stat-value" id="healthValue">100</div>
                    </div>
                </div>
                
                <div class="stat-box">
                    <i class="fas fa-bolt stat-icon"></i>
                    <div>
                        <div>DANO</div>
                        <div class="stat-value" id="damageValue">10</div>
                    </div>
                </div>
                
                <div class="stat-box">
                    <i class="fas fa-tachometer-alt stat-icon"></i>
                    <div>
                        <div>VELOCIDADE</div>
                        <div class="stat-value" id="speedValue">5</div>
                    </div>
                </div>
                
                <div class="wave-info">
                    <div class="wave-text">ONDA</div>
                    <div class="wave-number" id="waveNumber">1</div>
                </div>
            </div>
        </div>

        <!-- Área do jogo -->
        <div class="game-area">
            <div class="game-canvas-container">
                <canvas id="gameCanvas"></canvas>
            </div>
            
            <!-- Controles mobile -->
            <div class="mobile-controls" id="mobileControls">
                <div class="joystick-container">
                    <div class="joystick-base">
                        <div class="joystick" id="joystick"></div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <div class="action-btn" id="actionBtn">
                        <i class="fas fa-crosshairs"></i>
                    </div>
                    <div class="action-btn special" id="specialBtn">
                        <i class="fas fa-star"></i>
                    </div>
                </div>
            </div>
            
            <!-- Dica de controles para PC -->
            <div class="pc-hint" id="pcHint">
                <div class="hint-title">CONTROLES PC</div>
                <div class="hint-item">
                    <span>Movimento:</span>
                    <span>WASD ou SETAS</span>
                </div>
                <div class="hint-item">
                    <span>Habilidade Especial:</span>
                    <span>ESPAÇO</span>
                </div>
                <div class="hint-item">
                    <span>Pausar:</span>
                    <span>P ou ESC</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de upgrades entre ondas -->
    <div class="upgrade-screen" id="upgradeScreen">
        <div class="upgrade-title">UPGRADES DISPONÍVEIS!</div>
        <div class="upgrade-subtitle" id="upgradeSubtitle">Escolha 1 melhoria para continuar</div>
        
        <div class="upgrade-options" id="upgradeOptions">
            <!-- Os upgrades serão gerados dinamicamente aqui -->
        </div>
        
        <button class="upgrade-confirm" id="confirmUpgrade">CONFIRMAR ESCOLHA</button>
    </div>

    <!-- Tela de game over -->
    <div class="game-over-screen" id="gameOverScreen">
        <div class="game-over-title">GAME OVER</div>
        
        <div class="game-over-stats">
            <div class="stat-row">
                <div class="stat-label">Onda Alcançada:</div>
                <div class="stat-value-large" id="finalWave">1</div>
            </div>
            <div class="stat-row">
                <div class="stat-label">Inimigos Derrotados:</div>
                <div class="stat-value-large" id="finalKills">0</div>
            </div>
            <div class="stat-row">
                <div class="stat-label">Tempo Sobrevivido:</div>
                <div class="stat-value-large" id="finalTime">0s</div>
            </div>
            <div class="stat-row">
                <div class="stat-label">Dano Total:</div>
                <div class="stat-value-large" id="finalDamage">0</div>
            </div>
            <div class="stat-row">
                <div class="stat-label">Recorde Pessoal:</div>
                <div class="stat-value-large" id="finalRecord">0</div>
            </div>
        </div>
        
        <button class="restart-btn" id="restartBtn">JOGAR NOVAMENTE</button>
    </div>

    <script>
        // ===============================
        // CONFIGURAÇÃO E INICIALIZAÇÃO
        // ===============================
        const Game = {
            // Configurações do canvas
            canvas: null,
            ctx: null,
            
            // Estado do jogo
            state: 'loading', // loading, menu, playing, upgrading, gameover
            platform: 'pc', // pc ou mobile
            gameTime: 0,
            wave: 1,
            score: 0,
            kills: 0,
            totalDamage: 0,
            highScore: 0,
            
            // Controles
            keys: {},
            mouse: { x: 0, y: 0, down: false },
            joystick: { active: false, x: 0, y: 0 },
            
            // Jogador
            player: {
                x: 400,
                y: 300,
                radius: 20,
                health: 100,
                maxHealth: 100,
                damage: 10,
                speed: 5,
                attackSpeed: 0.5, // ataques por segundo
                attackTimer: 0,
                projectileSpeed: 8,
                specialCooldown: 0,
                specialMaxCooldown: 10000, // 10 segundos
                specialActive: false,
                specialTimer: 0,
                specialDuration: 3000, // 3 segundos
                color: '#FF6B35',
                trail: []
            },
            
            // Inimigos
            enemies: [],
            enemySpawnTimer: 0,
            enemySpawnRate: 1000, // ms entre spawns
            enemiesPerWave: 5,
            enemySpeed: 1.5,
            
            // Projéteis
            projectiles: [],
            enemyProjectiles: [],
            
            // Itens e upgrades
            items: [],
            upgrades: [],
            selectedUpgrade: null,
            
            // Sistema de partículas
            particles: [],
            
            // Configurações de upgrade disponíveis
            availableUpgrades: [
                {
                    id: 'damage_up',
                    name: 'DANO AUMENTADO',
                    description: 'Aumenta o dano dos seus ataques em 30%',
                    rarity: 'common',
                    effect: (player) => { player.damage = Math.floor(player.damage * 1.3); }
                },
                {
                    id: 'health_up',
                    name: 'VIDA EXTRA',
                    description: 'Aumenta sua vida máxima em 50%',
                    rarity: 'common',
                    effect: (player) => { 
                        player.maxHealth = Math.floor(player.maxHealth * 1.5);
                        player.health = player.maxHealth;
                    }
                },
                {
                    id: 'speed_up',
                    name: 'VELOCIDADE DE MOVIMENTO',
                    description: 'Aumenta sua velocidade de movimento em 25%',
                    rarity: 'common',
                    effect: (player) => { player.speed *= 1.25; }
                },
                {
                    id: 'attack_speed_up',
                    name: 'ATAQUE RÁPIDO',
                    description: 'Aumenta sua velocidade de ataque em 40%',
                    rarity: 'uncommon',
                    effect: (player) => { player.attackSpeed *= 1.4; }
                },
                {
                    id: 'piercing',
                    name: 'PROJÉTEIS PERFURANTES',
                    description: 'Seus projéteis atravessam múltiplos inimigos',
                    rarity: 'rare',
                    effect: (player) => { player.piercing = true; }
                },
                {
                    id: 'homing',
                    name: 'MÍSSEIS TELEGUIADOS',
                    description: 'Seus projéteis perseguem os inimigos',
                    rarity: 'rare',
                    effect: (player) => { player.homing = true; }
                },
                {
                    id: 'explosive',
                    name: 'TIROS EXPLOSIVOS',
                    description: 'Seus projéteis explodem ao atingir inimigos',
                    rarity: 'epic',
                    effect: (player) => { player.explosive = true; }
                },
                {
                    id: 'multishot',
                    name: 'DISPARO MÚLTIPLO',
                    description: 'Atira 3 projéteis simultaneamente',
                    rarity: 'epic',
                    effect: (player) => { player.multishot = 3; }
                },
                {
                    id: 'life_steal',
                    name: 'ROUBO DE VIDA',
                    description: 'Recupera 10% do dano causado como vida',
                    rarity: 'legendary',
                    effect: (player) => { player.lifeSteal = 0.1; }
                },
                {
                    id: 'chain_lightning',
                    name: 'RELÂMPAGO EM CADEIA',
                    description: 'Seus ataques saltam entre inimigos próximos',
                    rarity: 'legendary',
                    effect: (player) => { player.chainLightning = true; }
                }
            ],
            
            // Inicialização
            init() {
                console.log('Inicializando Potato Hero...');
                
                // Obter elementos do DOM
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // Configurar canvas
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // Configurar eventos
                this.setupEvents();
                
                // Carregar recursos
                this.loadResources();
            },
            
            // Redimensionar canvas
            resizeCanvas() {
                const container = this.canvas.parentElement;
                this.canvas.width = container.clientWidth;
                this.canvas.height = container.clientHeight;
            },
            
            // Configurar eventos
            setupEvents() {
                // Eventos de teclado para PC
                window.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                    
                    // Pausar com P ou ESC
                    if ((e.key === 'p' || e.key === 'Escape') && this.state === 'playing') {
                        this.togglePause();
                    }
                    
                    // Habilidade especial com ESPAÇO
                    if (e.key === ' ' && this.state === 'playing') {
                        this.activateSpecial();
                    }
                });
                
                window.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                // Eventos de mouse para PC
                this.canvas.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = e.clientX - rect.left;
                    this.mouse.y = e.clientY - rect.top;
                });
                
                this.canvas.addEventListener('mousedown', () => {
                    this.mouse.down = true;
                });
                
                this.canvas.addEventListener('mouseup', () => {
                    this.mouse.down = false;
                });
                
                // Eventos de toque para mobile
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = touch.clientX - rect.left;
                    this.mouse.y = touch.clientY - rect.top;
                    this.mouse.down = true;
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = touch.clientX - rect.left;
                    this.mouse.y = touch.clientY - rect.top;
                });
                
                this.canvas.addEventListener('touchend', () => {
                    this.mouse.down = false;
                });
                
                // Configurar controles mobile
                this.setupMobileControls();
                
                // Configurar botões da interface
                document.getElementById('mobileMode').addEventListener('click', () => this.setPlatform('mobile'));
                document.getElementById('pcMode').addEventListener('click', () => this.setPlatform('pc'));
                document.getElementById('restartBtn').addEventListener('click', () => this.restartGame());
                document.getElementById('confirmUpgrade').addEventListener('click', () => this.applyUpgrade());
// Configurar botão de ação mobile
                document.getElementById('actionBtn').addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.state === 'playing') {
                        this.shootProjectile();
                    }
                });
                
                document.getElementById('specialBtn').addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (this.state === 'playing') {
                        this.activateSpecial();
                    }
                });
            },
            
            // Configurar controles mobile (joystick)
            setupMobileControls() {
                const joystickBase = document.getElementById('joystick');
                let joystickBaseRect = null;
                let joystickTouchId = null;
                
                joystickBase.parentElement.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    if (joystickTouchId !== null) return;
                    
                    const touch = e.touches[0];
                    joystickTouchId = touch.identifier;
                    joystickBaseRect = joystickBase.parentElement.getBoundingClientRect();
                    this.joystick.active = true;
                    this.updateJoystick(touch);
                });
                
                document.addEventListener('touchmove', (e) => {
                    if (!this.joystick.active) return;
                    
                    for (let touch of e.touches) {
                        if (touch.identifier === joystickTouchId) {
                            e.preventDefault();
                            this.updateJoystick(touch);
                            break;
                        }
                    }
                });
                
                document.addEventListener('touchend', (e) => {
                    for (let touch of e.changedTouches) {
                        if (touch.identifier === joystickTouchId) {
                            this.joystick.active = false;
                            joystickTouchId = null;
                            this.joystick.x = 0;
                            this.joystick.y = 0;
                            
                            // Resetar posição do joystick visual
                            joystickBase.style.left = '50%';
                            joystickBase.style.top = '50%';
                            break;
                        }
                    }
                });
            },
            
            // Atualizar posição do joystick
            updateJoystick(touch) {
                const joystickBase = document.getElementById('joystick');
                if (!joystickBaseRect) return;
                
                const centerX = joystickBaseRect.left + joystickBaseRect.width / 2;
                const centerY = joystickBaseRect.top + joystickBaseRect.height / 2;
                
                let deltaX = touch.clientX - centerX;
                let deltaY = touch.clientY - centerY;
                
                // Limitar ao raio do joystick
                const maxDistance = joystickBaseRect.width / 2;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                if (distance > maxDistance) {
                    deltaX = (deltaX / distance) * maxDistance;
                    deltaY = (deltaY / distance) * maxDistance;
                }
                
                // Atualizar posição visual do joystick
                joystickBase.style.left = `${50 + (deltaX / maxDistance) * 50}%`;
                joystickBase.style.top = `${50 + (deltaY / maxDistance) * 50}%`;
                
                // Calcular direção normalizada para o movimento
                this.joystick.x = deltaX / maxDistance;
                this.joystick.y = deltaY / maxDistance;
            },
            
            // Carregar recursos do jogo
            loadResources() {
                console.log('Carregando recursos...');
                
                // Simular carregamento
                let progress = 0;
                const loadingBar = document.getElementById('loadingBar');
                const loadingText = document.getElementById('loadingText');
                const loadingMessages = [
                    'Carregando recursos do jogo...',
                    'Inicializando sistema de partículas...',
                    'Preparando inimigos...',
                    'Gerando mundo do jogo...',
                    'Quase pronto...'
                ];
                
                const interval = setInterval(() => {
                    progress += 20;
                    loadingBar.style.width = `${progress}%`;
                    
                    // Atualizar mensagem de carregamento
                    if (progress <= 100) {
                        const messageIndex = Math.floor(progress / 20);
                        if (messageIndex < loadingMessages.length) {
                            loadingText.textContent = loadingMessages[messageIndex];
                        }
                    }
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        loadingText.textContent = 'Carregamento completo!';
                        
                        // Mostrar seleção de plataforma
                        setTimeout(() => {
                            document.querySelector('.platform-select').style.opacity = '1';
                            document.querySelector('.platform-select').style.transform = 'translateY(0)';
                        }, 500);
                    }
                }, 300);
            },
            
            // Definir plataforma
            setPlatform(platform) {
                this.platform = platform;
                
                // Atualizar interface
                if (platform === 'mobile') {
                    document.getElementById('mobileControls').style.display = 'flex';
                    document.getElementById('pcHint').style.display = 'none';
                } else {
                    document.getElementById('mobileControls').style.display = 'none';
                    document.getElementById('pcHint').style.display = 'block';
                }
                
                // Iniciar jogo
                this.startGame();
            },
            
            // Iniciar jogo
            startGame() {
                console.log('Iniciando jogo...');
                
                // Esconder tela de carregamento
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('gameUI').style.display = 'flex';
                }, 500);
                
                // Resetar estado do jogo
                this.resetGame();
                
                // Iniciar loop do jogo
                this.state = 'playing';
                this.lastTime = performance.now();
                requestAnimationFrame((time) => this.gameLoop(time));
            },
            
            // Resetar jogo
            resetGame() {
                this.gameTime = 0;
                this.wave = 1;
                this.score = 0;
                this.kills = 0;
                this.totalDamage = 0;
                
                // Resetar jogador
                this.player = {
                    x: this.canvas.width / 2,
                    y: this.canvas.height / 2,
                    radius: 20,
                    health: 100,
                    maxHealth: 100,
                    damage: 10,
                    speed: 5,
                    attackSpeed: 0.5,
                    attackTimer: 0,
                    projectileSpeed: 8,
                    specialCooldown: 0,
                    specialMaxCooldown: 10000,
                    specialActive: false,
                    specialTimer: 0,
                    specialDuration: 3000,
                    color: '#FF6B35',
                    trail: [],
                    upgrades: []
                };
                
                // Limpar arrays
                this.enemies = [];
                this.projectiles = [];
                this.enemyProjectiles = [];
                this.items = [];
                this.particles = [];
                
                // Atualizar UI
                this.updateUI();
                
                // Gerar primeira onda
                this.generateWave();
            },
            
            // Loop principal do jogo
            gameLoop(currentTime) {
                // Calcular delta time
                const deltaTime = currentTime - (this.lastTime || currentTime);
                this.lastTime = currentTime;
                
                // Atualizar lógica do jogo
                if (this.state === 'playing') {
                    this.gameTime += deltaTime;
                    this.update(deltaTime);
                }
                
                // Renderizar
                this.render();
                
                // Continuar loop
                requestAnimationFrame((time) => this.gameLoop(time));
            },
            
            // Atualizar lógica do jogo
            update(deltaTime) {
                // Atualizar jogador
                this.updatePlayer(deltaTime);
                
                // Atualizar projéteis
                this.updateProjectiles(deltaTime);
                
                // Atualizar inimigos
                this.updateEnemies(deltaTime);
                
                // Atualizar partículas
                this.updateParticles(deltaTime);
                
                // Verificar colisões
                this.checkCollisions();
                
                // Verificar se wave foi completada
                if (this.enemies.length === 0) {
                    this.showUpgradeScreen();
                }
                
                // Atualizar temporizadores
                this.player.attackTimer += deltaTime;
                if (this.player.specialCooldown > 0) {
                    this.player.specialCooldown -= deltaTime;
                }
                
                if (this.player.specialActive) {
                    this.player.specialTimer += deltaTime;
                    if (this.player.specialTimer >= this.player.specialDuration) {
                        this.player.specialActive = false;
                        this.player.specialTimer = 0;
                    }
                }
            },
            
            // Atualizar jogador
            updatePlayer(deltaTime) {
                // Movimentação baseada na plataforma
                let moveX = 0;
                let moveY = 0;
                
                if (this.platform === 'pc') {
                    // Controles de teclado
                    if (this.keys['w'] || this.keys['arrowup']) moveY -= 1;
                    if (this.keys['s'] || this.keys['arrowdown']) moveY += 1;
                    if (this.keys['a'] || this.keys['arrowleft']) moveX -= 1;
                    if (this.keys['d'] || this.keys['arrowright']) moveX += 1;
                } else if (this.platform === 'mobile' && this.joystick.active) {
                    // Controle de joystick
                    moveX = this.joystick.x;
                    moveY = this.joystick.y;
                }
                
                // Normalizar movimento diagonal
                if (moveX !== 0 || moveY !== 0) {
                    const length = Math.sqrt(moveX * moveX + moveY * moveY);
                    moveX /= length;
                    moveY /= length;
                    
                    // Aplicar movimento
                    this.player.x += moveX * this.player.speed * (deltaTime / 16);
                    this.player.y += moveY * this.player.speed * (deltaTime / 16);
                    
                    // Limitar ao canvas
                    this.player.x = Math.max(this.player.radius, Math.min(this.canvas.width - this.player.radius, this.player.x));
                    this.player.y = Math.max(this.player.radius, Math.min(this.canvas.height - this.player.radius, this.player.y));
                    
                    // Adicionar ao rastro
                    this.player.trail.push({
                        x: this.player.x,
                        y: this.player.y,
                        alpha: 1,
                        radius: this.player.radius * 0.7
                    });
                    
                    // Limitar tamanho do rastro
                    if (this.player.trail.length > 10) {
                        this.player.trail.shift();
                    }
                }
                
                // Atualizar rastro
                for (let i = this.player.trail.length - 1; i >= 0; i--) {
                    this.player.trail[i].alpha -= 0.05;
                    if (this.player.trail[i].alpha <= 0) {
                        this.player.trail.splice(i, 1);
                    }
                }
                
                // Disparo automático
                const attackInterval = 1000 / this.player.attackSpeed;
                if (this.player.attackTimer >= attackInterval) {
                    this.player.attackTimer = 0;
                    this.shootProjectile();
                }
            },
            
            // Disparar projétil
            shootProjectile() {
                if (this.player.specialActive) {
                    // Disparo especial (360 graus)
                    for (let i = 0; i < 8; i++) {
                        const angle = (i * Math.PI * 2) / 8;
                        this.createProjectile(
                            this.player.x,
                            this.player.y,
                            Math.cos(angle),
                            Math.sin(angle),
                            this.player.damage * 2,
                            this.player.projectileSpeed * 1.5,
                            '#FFD166'
                        );
                    }
                } else {
                    // Disparo normal
                    let targetX, targetY;
                    
                    if (this.platform === 'pc') {
                        // Mirar com mouse
                        targetX = this.mouse.x;
                        targetY = this.mouse.y;
                    } else {
                        // Mirar no inimigo mais próximo
                        let nearestEnemy = null;
                        let nearestDistance = Infinity;
                        
                        for (const enemy of this.enemies) {
                            const dx = enemy.x - this.player.x;
                            const dy = enemy.y - this.player.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < nearestDistance) {
                                nearestDistance = distance;
                                nearestEnemy = enemy;
                            }
                        }
                        
                        if (nearestEnemy) {
                            targetX = nearestEnemy.x;
                            targetY = nearestEnemy.y;
                        } else {
                            // Se não houver inimigos, atirar para cima
                            targetX = this.player.x;
                            targetY = this.player.y - 100;
                        }
                    }
                    
                    // Calcular direção
                    const dx = targetX - this.player.x;
                    const dy = targetY - this.player.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const dirX = dx / distance;
                    const dirY = dy / distance;
                    
                    // Criar projétil
                    this.createProjectile(
                        this.player.x,
                        this.player.y,
                        dirX,
                        dirY,
                        this.player.damage,
                        this.player.projectileSpeed,
                        this.player.color
                    );
                    
                    // Multishot (se tiver o upgrade)
                    if (this.player.multishot && this.player.multishot > 1) {
                        const spread = 0.2; // Radianos de spread
                        
                        for (let i = 1; i < this.player.multishot; i++) {
                            const angleOffset = (i - (this.player.multishot - 1) / 2) * spread;
                            const cos = Math.cos(angleOffset);
                            const sin = Math.sin(angleOffset);
                            
                            const newDirX = dirX * cos - dirY * sin;
                            const newDirY = dirX * sin + dirY * cos;
                            
                            this.createProjectile(
                                this.player.x,
                                this.player.y,
                                newDirX,
                                newDirY,
                                this.player.damage * 0.7,
                                this.player.projectileSpeed,
                                this.player.color
                            );
                        }
                    }
                }
                
                // Efeito visual
                this.createParticles(this.player.x, this.player.y, 5, '#FFFFFF');
            },
            
            // Ativar habilidade especial
            activateSpecial() {
                if (this.player.specialCooldown <= 0 && !this.player.specialActive) {
                    this.player.specialActive = true;
                    this.player.specialTimer = 0;
                    this.player.specialCooldown = this.player.specialMaxCooldown;
                    
                    // Efeito visual
                    this.createParticles(this.player.x, this.player.y, 30, '#FFD166');
                }
            },
            
            // Criar projétil
            createProjectile(x, y, dirX, dirY, damage, speed, color) {
                this.projectiles.push({
                    x, y,
                    dirX, dirY,
                    damage,
                    speed,
                    color,
                    radius: 6,
                    lifetime: 2000, // 2 segundos
                    piercing: this.player.piercing || false,
                    homing: this.player.homing || false,
                    explosive: this.player.explosive || false,
                    chainLightning: this.player.chainLightning || false,
                    targetsHit: []
                });
            },
            
            // Atualizar projéteis
            updateProjectiles(deltaTime) {
                // Projéteis do jogador
                for (let i = this.projectiles.length - 1; i >= 0; i--) {
                    const proj = this.projectiles[i];
                    
                    // Movimentação
                    proj.x += proj.dirX * proj.speed * (deltaTime / 16);
                    proj.y += proj.dirY * proj.speed * (deltaTime / 16);
                    
                    // Homing (se tiver upgrade)
                    if (proj.homing && this.enemies.length > 0) {
                        // Encontrar inimigo mais próximo
                        let nearestEnemy = null;
                        let nearestDistance = Infinity;
                        
                        for (const enemy of this.enemies) {
                            const dx = enemy.x - proj.x;
                            const dy = enemy.y - proj.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < nearestDistance && distance < 200) {
                                nearestDistance = distance;
                                nearestEnemy = enemy;
                            }
                        }
                        
                        // Ajustar direção
                        if (nearestEnemy) {
                            const dx = nearestEnemy.x - proj.x;
                            const dy = nearestEnemy.y - proj.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            const strength = 0.1;
                            
                            proj.dirX = proj.dirX * (1 - strength) + (dx / distance) * strength;
                            proj.dirY = proj.dirY * (1 - strength) + (dy / distance) * strength;
                            
                            // Normalizar
                            const length = Math.sqrt(proj.dirX * proj.dirX + proj.dirY * proj.dirY);
                            proj.dirX /= length;
                            proj.dirY /= length;
                        }
                    }
                    
                    // Verificar se saiu da tela
                    if (proj.x < -proj.radius || proj.x > this.canvas.width + proj.radius ||
                        proj.y < -proj.radius || proj.y > this.canvas.height + proj.radius) {
                        this.projectiles.splice(i, 1);
                        continue;
                    }
                    
                    // Atualizar tempo de vida
                    proj.lifetime -= deltaTime;
                    if (proj.lifetime <= 0) {
                        this.projectiles.splice(i, 1);
                    }
                }
                
                // Projéteis dos inimigos
                for (let i = this.enemyProjectiles.length - 1; i >= 0; i--) {
                    const proj = this.enemyProjectiles[i];
                    
                    // Movimentação
                    proj.x += proj.dirX * proj.speed * (deltaTime / 16);
                    proj.y += proj.dirY * proj.speed * (deltaTime / 16);
                    
                    // Verificar se saiu da tela
                    if (proj.x < -proj.radius || proj.x > this.canvas.width + proj.radius ||
                        proj.y < -proj.radius || proj.y > this.canvas.height + proj.radius) {
                        this.enemyProjectiles.splice(i, 1);
                    }
                }
            },
            
            // Atualizar inimigos
            updateEnemies(deltaTime) {
                // Gerar inimigos
                this.enemySpawnTimer += deltaTime;
                if (this.enemySpawnTimer >= this.enemySpawnRate && this.enemies.length < this.enemiesPerWave) {
                    this.enemySpawnTimer = 0;
                    this.spawnEnemy();
                }
                
                // Atualizar inimigos existentes
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    const enemy = this.enemies[i];
                    
                    // Seguir jogador
                    const dx = this.player.x - enemy.x;
                    const dy = this.player.y - enemy.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 0) {
                        enemy.dirX = dx / distance;
                        enemy.dirY = dy / distance;
                        
                        // Movimentação
                        enemy.x += enemy.dirX * enemy.speed * (deltaTime / 16);
                        enemy.y += enemy.dirY * enemy.speed * (deltaTime / 16);
                    }
                    
                    // Atacar (alguns inimigos disparam)
                    if (enemy.type === 'ranged' && enemy.attackTimer <= 0) {
                        this.enemyShoot(enemy);
                        enemy.attackTimer = enemy.attackSpeed;
                    }
                    
                    enemy.attackTimer -= deltaTime;
                    
                    // Atualizar animação
                    enemy.animationTimer += deltaTime;
                }
            },
            
            // Gerar inimigo
            spawnEnemy() {
                // Escolher tipo de inimigo baseado na wave
                let type = 'melee';
                if (this.wave >= 3 && Math.random() < 0.3) type = 'ranged';
                if (this.wave >= 5 && Math.random() < 0.2) type = 'tank';
                if (this.wave >= 7 && Math.random() < 0.1) type = 'boss';
                
                // Configurações base
                let enemy = {
                    x: 0,
                    y: 0,
                    radius: 15,
                    health: 30,
                    maxHealth: 30,
                    damage: 10,
                    speed: this.enemySpeed,
                    color: '#EF476F',
                    type: type,
                    attackTimer: 0,
                    attackSpeed: 2000,
                    animationTimer: 0,
                    dirX: 0,
                    dirY: 0
                };
                
                // Ajustar baseado no tipo
                switch(type) {
                    case 'melee':
                        enemy.speed = this.enemySpeed * 1.2;
                        enemy.color = '#EF476F';
                        break;
                    case 'ranged':
                        enemy.radius = 12;
                        enemy.speed = this.enemySpeed * 0.8;
                        enemy.health = 20;
                        enemy.maxHealth = 20;
                        enemy.color = '#00C2D1';
                        enemy.attackSpeed = 1500;
                        break;
                    case 'tank':
                        enemy.radius = 25;
                        enemy.speed = this.enemySpeed * 0.5;
                        enemy.health = 100;
                        enemy.maxHealth = 100;
                        enemy.damage = 20;
                        enemy.color = '#7B68EE';
                        break;
                    case 'boss':
                        enemy.radius = 40;
                        enemy.speed = this.enemySpeed * 0.3;
                        enemy.health = 300;
                        enemy.maxHealth = 300;
                        enemy.damage = 30;
                        enemy.color = '#FF8B5A';
                        enemy.attackSpeed = 1000;
                        break;
                }
                
                // Aumentar stats baseado na wave
                const waveMultiplier = 1 + (this.wave - 1) * 0.2;
                enemy.health = Math.floor(enemy.health * waveMultiplier);
                enemy.maxHealth = enemy.health;
                enemy.damage = Math.floor(enemy.damage * waveMultiplier);
                
                // Posição aleatória fora da tela
                const side = Math.floor(Math.random() * 4);
                switch(side) {
                    case 0: // Topo
                        enemy.x = Math.random() * this.canvas.width;
                        enemy.y = -enemy.radius;
                        break;
                    case 1: // Direita
                        enemy.x = this.canvas.width + enemy.radius;
                        enemy.y = Math.random() * this.canvas.height;
                        break;
                    case 2: // Baixo
                        enemy.x = Math.random() * this.canvas.width;
                        enemy.y = this.canvas.height + enemy.radius;
                        break;
                    case 3: // Esquerda
                        enemy.x = -enemy.radius;
                        enemy.y = Math.random() * this.canvas.height;
                        break;
                }
                
                this.enemies.push(enemy);
            },
            
            // Inimigo atirar
            enemyShoot(enemy) {
                // Calcular direção para o jogador
                const dx = this.player.x - enemy.x;
                const dy = this.player.y - enemy.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 0) {
                    this.enemyProjectiles.push({
                        x: enemy.x,
                        y: enemy.y,
                        dirX: dx / distance,
                        dirY: dy / distance,
                        damage: enemy.damage * 0.5,
                        speed: 4,
                        color: enemy.color,
                        radius: 8
                    });
                    
                    // Efeito visual
                    this.createParticles(enemy.x, enemy.y, 5, enemy.color);
                }
            },
            
            // Atualizar partículas
            updateParticles(deltaTime) {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    
                    // Movimentação
                    p.x += p.vx * (deltaTime / 16);
                    p.y += p.vy * (deltaTime / 16);
                    
                    // Atrito
                    p.vx *= 0.95;
                    p.vy *= 0.95;
                    
                    // Vida
                    p.life -= deltaTime;
                    p.alpha = p.life / p.maxLife;
                    
                    if (p.life <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            },
            
            // Criar partículas
            createParticles(x, y, count, color) {
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 2 + Math.random() * 3;
                    
                    this.particles.push({
                        x, y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        radius: 2 + Math.random() * 4,
                        color: color,
                        life: 500 + Math.random() * 500,
                        maxLife: 1000,
                        alpha: 1
                    });
                }
            },
            
            // Verificar colisões
            checkCollisions() {
                // Projéteis do jogador vs Inimigos
                for (let i = this.projectiles.length - 1; i >= 0; i--) {
                    const proj = this.projectiles[i];
                    let hitSomething = false;
                    
                    for (let j = this.enemies.length - 1; j >= 0; j--) {
                        const enemy = this.enemies[j];
                        
                        // Verificar se já acertou este inimigo (para projéteis perfurantes)
                        if (proj.targetsHit.includes(j)) continue;
                        
                        // Calcular distância
                        const dx = proj.x - enemy.x;
                        const dy = proj.y - enemy.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < proj.radius + enemy.radius) {
                            // Dano
                            enemy.health -= proj.damage;
                            this.totalDamage += proj.damage;
                            
                            // Efeito visual
                            this.createParticles(enemy.x, enemy.y, 8, enemy.color);
                            
                            // Adicionar à lista de acertos
                            proj.targetsHit.push(j);
                            
                            // Life steal (se tiver upgrade)
                            if (this.player.lifeSteal) {
                                const heal = Math.floor(proj.damage * this.player.lifeSteal);
                                this.player.health = Math.min(this.player.maxHealth, this.player.health + heal);
                                
                                // Efeito visual de cura
                                this.createParticles(this.player.x, this.player.y, 3, '#06D6A0');
                            }
                            
                            // Verificar se inimigo morreu
                            if (enemy.health <= 0) {
                                // Pontuação
                                this.kills++;
                                this.score += enemy.type === 'boss' ? 500 : 
                                            enemy.type === 'tank' ? 100 : 
                                            enemy.type === 'ranged' ? 50 : 25;
                                
                                // Criar item (chance)
                                if (Math.random() < 0.2) {
                                    this.createItem(enemy.x, enemy.y);
                                }
                                
                                // Remover inimigo
                                this.enemies.splice(j, 1);
                                
                                // Efeito de morte
                                this.createParticles(enemy.x, enemy.y, 15, enemy.color);
                            }
                            
                            // Chain lightning (se tiver upgrade)
                            if (proj.chainLightning) {
                                // Encontrar inimigos próximos
                                for (let k = this.enemies.length - 1; k >= 0; k--) {
                                    if (k === j) continue;
                                    
                                    const otherEnemy = this.enemies[k];
                                    const dx2 = enemy.x - otherEnemy.x;
                                    const dy2 = enemy.y - otherEnemy.y;
                                    const distance2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
                                    
                                    if (distance2 < 100) {
                                        otherEnemy.health -= proj.damage * 0.5;
                                        this.totalDamage += proj.damage * 0.5;
                                        
                                        // Efeito visual de corrente
                                        this.createLightningEffect(enemy.x, enemy.y, otherEnemy.x, otherEnemy.y);
                                    }
                                }
                            }
                            
                            // Explosivo (se tiver upgrade)
                            if (proj.explosive) {
                                // Dano em área
                                for (let k = this.enemies.length - 1; k >= 0; k--) {
                                    if (k === j) continue;
                                    
                                    const otherEnemy = this.enemies[k];
                                    const dx2 = proj.x - otherEnemy.x;
                                    const dy2 = proj.y - otherEnemy.y;
                                    const distance2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
                                    
                                    if (distance2 < 80) {
                                        const damage = proj.damage * (1 - distance2 / 80);
                                        otherEnemy.health -= damage;
                                        this.totalDamage += damage;
                                        
                                        // Efeito visual
                                        this.createParticles(otherEnemy.x, otherEnemy.y, 3, otherEnemy.color);
                                    }
                                }
                                
                                // Efeito de explosão
                                this.createExplosionEffect(proj.x, proj.y);
                            }
                            
                            hitSomething = true;
                            
                            // Se não for perfurante, remover projétil
                            if (!proj.piercing) {
                                this.projectiles.splice(i, 1);
                                break;
                            }
                        }
                    }
                    
                    // Se não for perfurante e não acertou nada, sair do loop
                    if (!proj.piercing && hitSomething) {
                        break;
                    }
                }
                
                // Projéteis dos inimigos vs Jogador
                for (let i = this.enemyProjectiles.length - 1; i >= 0; i--) {
                    const proj = this.enemyProjectiles[i];
                    
                    const dx = proj.x - this.player.x;
                    const dy = proj.y - this.player.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < proj.radius + this.player.radius) {
                        // Dano
                        this.player.health -= proj.damage;
                        
                        // Efeito visual
                        this.createParticles(this.player.x, this.player.y, 10, '#EF476F');
                        this.player.color = '#FFFFFF'; // Flash branco
                        setTimeout(() => {
                            this.player.color = '#FF6B35';
                        }, 100);
                        
                        // Remover projétil
                        this.enemyProjectiles.splice(i, 1);
                        
                        // Verificar game over
                        if (this.player.health <= 0) {
                            this.gameOver();
                        }
                    }
                }
                
                // Inimigos vs Jogador (colisão corpo a corpo)
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    const enemy = this.enemies[i];
                    
                    const dx = enemy.x - this.player.x;
                    const dy = enemy.y - this.player.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < enemy.radius + this.player.radius) {
                        // Dano (apenas inimigos melee ou todos se estiverem muito próximos)
                        if (enemy.type === 'melee' || distance < (enemy.radius + this.player.radius) * 0.7) {
                            this.player.health -= enemy.damage * 0.1; // Dano contínuo menor
                            
                            // Empurrar jogador
                            const pushForce = 3;
                            this.player.x -= (dx / distance) * pushForce;
                            this.player.y -= (dy / distance) * pushForce;
                            
                            // Efeito visual
                            this.createParticles(this.player.x, this.player.y, 5, '#EF476F');
                            
                            // Verificar game over
                            if (this.player.health <= 0) {
                                this.gameOver();
                            }
                        }
                    }
                }
                
                // Itens vs Jogador
                for (let i = this.items.length - 1; i >= 0; i--) {
                    const item = this.items[i];
                    
                    const dx = item.x - this.player.x;
                    const dy = item.y - this.player.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < item.radius + this.player.radius) {
                        // Coletar item
                        this.collectItem(item);
                        this.items.splice(i, 1);
                    }
                }
            },
            
            // Criar item
            createItem(x, y) {
                const types = ['health', 'damage', 'speed'];
                const type = types[Math.floor(Math.random() * types.length)];
                
                let color, effect;
                switch(type) {
                    case 'health':
                        color = '#06D6A0';
                        effect = 'Cura 20% da vida máxima';
                        break;
                    case 'damage':
                        color = '#FF6B35';
                        effect = 'Aumenta dano em 10% por 10s';
                        break;
                    case 'speed':
                        color = '#00C2D1';
                        effect = 'Aumenta velocidade em 20% por 10s';
                        break;
                }
                
                this.items.push({
                    x, y,
                    radius: 10,
                    color: color,
                    type: type,
                    effect: effect,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    life: 10000 // 10 segundos
                });
            },
            
            // Coletar item
            collectItem(item) {
                // Efeito visual
                this.createParticles(item.x, item.y, 15, item.color);
                
                // Aplicar efeito
                switch(item.type) {
                    case 'health':
                        const heal = this.player.maxHealth * 0.2;
                        this.player.health = Math.min(this.player.maxHealth, this.player.health + heal);
                        this.createFloatingText(item.x, item.y, `+${Math.floor(heal)} HP`, '#06D6A0');
                        break;
                        
                    case 'damage':
                        const originalDamage = this.player.damage;
                        this.player.damage *= 1.1;
                        this.createFloatingText(item.x, item.y, 'DANO ↑', '#FF6B35');
                        
                        setTimeout(() => {
                            this.player.damage = originalDamage;
                        }, 10000);
                        break;
                        
                    case 'speed':
                        const originalSpeed = this.player.speed;
                        this.player.speed *= 1.2;
                        this.createFloatingText(item.x, item.y, 'VELOCIDADE ↑', '#00C2D1');
                        
                        setTimeout(() => {
                            this.player.speed = originalSpeed;
                        }, 10000);
                        break;
                }
                
                // Atualizar UI
                this.updateUI();
            },
            
            // Criar efeito de explosão
            createExplosionEffect(x, y) {
                for (let i = 0; i < 20; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 3 + Math.random() * 4;
                    
                    this.particles.push({
                        x, y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        radius: 3 + Math.random() * 5,
                        color: '#FFD166',
                        life: 300 + Math.random() * 300,
                        maxLife: 600,
                        alpha: 1
                    });
                }
            },
            
            // Criar efeito de relâmpago
            createLightningEffect(x1, y1, x2, y2) {
                const segments = 5;
                const points = [];
                
                points.push({x: x1, y: y1});
                
                for (let i = 1; i < segments; i++) {
                    const t = i / segments;
                    const x = x1 + (x2 - x1) * t + (Math.random() - 0.5) * 20;
                    const y = y1 + (y2 - y1) * t + (Math.random() - 0.5) * 20;
                    points.push({x, y});
                }
                
                points.push({x: x2, y: y2});
                
                // Adicionar como partícula especial
                this.particles.push({
                    type: 'lightning',
                    points: points,
                    color: '#00C2D1',
                    life: 100,
                    maxLife: 100,
                    alpha: 1
                });
            },
            
            // Criar texto flutuante
            createFloatingText(x, y, text, color) {
                this.particles.push({
                    type: 'text',
                    x, y,
                    text: text,
                    color: color,
                    life: 1000,
                    maxLife: 1000,
                    alpha: 1,
                    vy: -1
                });
            },
            
            // Gerar wave
            generateWave() {
                this.wave++;
                this.enemiesPerWave = 5 + this.wave * 2;
                this.enemySpeed = 1.5 + this.wave * 0.1;
                this.enemySpawnRate = Math.max(500, 1000 - this.wave * 50);
                
                // Atualizar UI
                document.getElementById('waveNumber').textContent = this.wave;
                this.updateUI();
                
                // Notificação
                this.createFloatingText(this.canvas.width / 2, this.canvas.height / 2, `ONDA ${this.wave}`, '#FFD166');
            },
            
            // Mostrar tela de upgrades
            showUpgradeScreen() {
                this.state = 'upgrading';
                document.getElementById('upgradeScreen').style.display = 'flex';
                
                // Gerar opções de upgrade
                this.generateUpgradeOptions();
            },
            
            // Gerar opções de upgrade
            generateUpgradeOptions() {
                const container = document.getElementById('upgradeOptions');
                container.innerHTML = '';
                
                // Escolher 3 upgrades aleatórios
                const available = [...this.availableUpgrades];
                const selectedUpgrades = [];
                
                // Filtrar upgrades já obtidos
                const playerUpgradeIds = this.player.upgrades.map(u => u.id);
                const filteredUpgrades = available.filter(u => !playerUpgradeIds.includes(u.id));
                
                // Se o jogador já tiver muitos upgrades, permitir duplicatas
                const source = filteredUpgrades.length >= 3 ? filteredUpgrades : available;
                
                for (let i = 0; i < 3; i++) {
                    if (source.length === 0) break;
                    
                    const index = Math.floor(Math.random() * source.length);
                    selectedUpgrades.push(source[index]);
                    
                    // Não remover da fonte se estiver usando filteredUpgrades (para evitar duplicatas na mesma seleção)
                    if (source === filteredUpgrades) {
                        source.splice(index, 1);
                    }
                }
                
                // Criar cards
                selectedUpgrades.forEach((upgrade, index) => {
                    const card = document.createElement('div');
                    card.className = 'upgrade-card';
                    card.dataset.index = index;
                    
                    card.innerHTML = `
                        <div class="upgrade-header">
                            <div class="upgrade-name">${upgrade.name}</div>
                            <div class="upgrade-rarity rarity-${upgrade.rarity}">${upgrade.rarity.toUpperCase()}</div>
                        </div>
                        <div class="upgrade-description">${upgrade.description}</div>
                        <div class="upgrade-stats">
                            <span>Clique para selecionar</span>
                            <span><i class="fas fa-mouse-pointer"></i></span>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        // Remover seleção anterior
                        document.querySelectorAll('.upgrade-card').forEach(c => {
                            c.classList.remove('selected');
                        });
                        
                        // Selecionar este card
                        card.classList.add('selected');
                        this.selectedUpgrade = upgrade;
                    });
                    
                    container.appendChild(card);
                });
                
                // Selecionar primeiro card por padrão
                if (container.firstChild) {
                    container.firstChild.click();
                }
            },
            
            // Aplicar upgrade
            applyUpgrade() {
                if (!this.selectedUpgrade) return;
                
                // Aplicar efeito
                this.selectedUpgrade.effect(this.player);
                
                // Adicionar à lista de upgrades
                this.player.upgrades.push(this.selectedUpgrade);
                
                // Fechar tela
                document.getElementById('upgradeScreen').style.display = 'none';
                
                // Gerar próxima wave
                this.generateWave();
                
                // Voltar ao jogo
                this.state = 'playing';
                
                // Atualizar UI
                this.updateUI();
                
                // Efeito visual
                this.createParticles(this.player.x, this.player.y, 20, '#00C2D1');
                this.createFloatingText(this.player.x, this.player.y, this.selectedUpgrade.name, '#00C2D1');
            },
            
            // Game over
            gameOver() {
                this.state = 'gameover';
                
                // Atualizar estatísticas finais
                document.getElementById('finalWave').textContent = this.wave;
                document.getElementById('finalKills').textContent = this.kills;
                document.getElementById('finalTime').textContent = `${Math.floor(this.gameTime / 1000)}s`;
                document.getElementById('finalDamage').textContent = this.totalDamage;
                
                // Atualizar recorde
                if (this.wave > this.highScore) {
                    this.highScore = this.wave;
                }
                document.getElementById('finalRecord').textContent = this.highScore;
                
                // Mostrar tela de game over
                document.getElementById('gameOverScreen').style.display = 'flex';
                
                // Efeito visual
                this.createParticles(this.player.x, this.player.y, 50, '#EF476F');
            },
            
            // Reiniciar jogo
            restartGame() {
                // Esconder tela de game over
                document.getElementById('gameOverScreen').style.display = 'none';
                
                // Resetar jogo
                this.resetGame();
                
                // Voltar ao jogo
                this.state = 'playing';
            },
            
            // Alternar pausa
            togglePause() {
                if (this.state === 'playing') {
                    this.state = 'paused';
                    // Poderia mostrar um menu de pausa aqui
                } else if (this.state === 'paused') {
                    this.state = 'playing';
                }
            },
            
            // Atualizar UI
            updateUI() {
                document.getElementById('healthValue').textContent = Math.max(0, Math.floor(this.player.health));
                document.getElementById('damageValue').textContent = Math.floor(this.player.damage);
                document.getElementById('speedValue').textContent = this.player.speed.toFixed(1);
                
                // Barra de vida (visual)
                const healthPercent = (this.player.health / this.player.maxHealth) * 100;
                // Poderíamos atualizar uma barra de vida visual aqui se adicionarmos uma
            },
            
            // Renderizar
            render() {
                // Limpar canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Desenhar fundo
                this.drawBackground();
                
                // Desenhar itens
                this.drawItems();
                
                // Desenhar inimigos
                this.drawEnemies();
                
                // Desenhar projéteis
                this.drawProjectiles();
                
                // Desenhar jogador
                this.drawPlayer();
                
                // Desenhar partículas
                this.drawParticles();
                
                // Desenhar HUD
                if (this.state === 'playing') {
                    this.drawHUD();
                }
            },
            
            // Desenhar fundo
            drawBackground() {
                // Gradiente
                const gradient = this.ctx.createRadialGradient(
                    this.canvas.width / 2, this.canvas.height / 2, 0,
                    this.canvas.width / 2, this.canvas.height / 2, Math.max(this.canvas.width, this.canvas.height) / 2
                );
                gradient.addColorStop(0, 'rgba(10, 17, 40, 0.8)');
                gradient.addColorStop(1, 'rgba(6, 10, 26, 0.9)');
                
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Grade sutil
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                this.ctx.lineWidth = 1;
                
                const gridSize = 50;
                for (let x = 0; x < this.canvas.width; x += gridSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
                
                for (let y = 0; y < this.canvas.height; y += gridSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }
            },
            
            // Desenhar jogador
            drawPlayer() {
                // Desenhar rastro
                for (let i = 0; i < this.player.trail.length; i++) {
                    const point = this.player.trail[i];
                    
                    this.ctx.globalAlpha = point.alpha * 0.5;
                    this.ctx.fillStyle = this.player.color;
                    this.ctx.beginPath();
                    this.ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                
                this.ctx.globalAlpha = 1;
                
                // Desenhar jogador
                this.ctx.fillStyle = this.player.color;
                this.ctx.beginPath();
                this.ctx.arc(this.player.x, this.player.y, this.player.radius, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Contorno
                this.ctx.strokeStyle = '#FFFFFF';
                this.ctx.lineWidth = 2;
                this.ctx.stroke();
                
                // Olhos (para dar personalidade)
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.beginPath();
                this.ctx.arc(this.player.x - 6, this.player.y - 6, 4, 0, Math.PI * 2);
                this.ctx.arc(this.player.x + 6, this.player.y - 6, 4, 0, Math.PI * 2);
                this.ctx.fill();
                
                this.ctx.fillStyle = '#000000';
                this.ctx.beginPath();
                this.ctx.arc(this.player.x - 6, this.player.y - 6, 2, 0, Math.PI * 2);
                this.ctx.arc(this.player.x + 6, this.player.y - 6, 2, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Sorriso
                this.ctx.strokeStyle = '#000000';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.arc(this.player.x, this.player.y + 4, 8, 0.2, Math.PI - 0.2);
                this.ctx.stroke();
                
                // Efeito especial (se ativo)
                if (this.player.specialActive) {
                    this.ctx.globalAlpha = 0.3;
                    this.ctx.fillStyle = '#FFD166';
                    this.ctx.beginPath();
                    this.ctx.arc(this.player.x, this.player.y, this.player.radius * 2, 0, Math.PI * 2);
                    this.ctx.fill();
                    this.ctx.globalAlpha = 1;
                }
            },
            
            // Desenhar inimigos
            drawEnemies() {
                for (const enemy of this.enemies) {
                    // Corpo
                    this.ctx.fillStyle = enemy.color;
                    this.ctx.beginPath();
                    
                    // Inimigos com animação de pulsação
                    const pulse = Math.sin(enemy.animationTimer / 200) * 3;
                    this.ctx.arc(enemy.x, enemy.y, enemy.radius + pulse, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Contorno
                    this.ctx.strokeStyle = '#FFFFFF';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                    
                    // Barra de vida
                    if (enemy.health < enemy.maxHealth) {
                        const healthPercent = enemy.health / enemy.maxHealth;
                        const barWidth = enemy.radius * 2;
                        const barHeight = 4;
                        
                        this.ctx.fillStyle = '#EF476F';
                        this.ctx.fillRect(
                            enemy.x - enemy.radius,
                            enemy.y - enemy.radius - 10,
                            barWidth,
                            barHeight
                        );
                        
                        this.ctx.fillStyle = '#06D6A0';
                        this.ctx.fillRect(
                            enemy.x - enemy.radius,
                            enemy.y - enemy.radius - 10,
                            barWidth * healthPercent,
                            barHeight
                        );
                    }
                    
                    // Olhos (diferentes para cada tipo)
                    this.ctx.fillStyle = '#FFFFFF';
                    
                    if (enemy.type === 'boss') {
                        // Olhos de chefe (bravos)
                        this.ctx.beginPath();
                        this.ctx.arc(enemy.x - 10, enemy.y - 8, 6, 0, Math.PI * 2);
                        this.ctx.arc(enemy.x + 10, enemy.y - 8, 6, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        this.ctx.fillStyle = '#000000';
                        this.ctx.beginPath();
                        this.ctx.arc(enemy.x - 10, enemy.y - 8, 3, 0, Math.PI * 2);
                        this.ctx.arc(enemy.x + 10, enemy.y - 8, 3, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        // Sobrancelhas
                        this.ctx.strokeStyle = '#000000';
                        this.ctx.lineWidth = 3;
                        this.ctx.beginPath();
                        this.ctx.moveTo(enemy.x - 15, enemy.y - 15);
                        this.ctx.lineTo(enemy.x - 5, enemy.y - 12);
                        this.ctx.moveTo(enemy.x + 5, enemy.y - 12);
                        this.ctx.lineTo(enemy.x + 15, enemy.y - 15);
                        this.ctx.stroke();
                    } else {
                        // Olhos normais
                        this.ctx.beginPath();
                        this.ctx.arc(enemy.x - 5, enemy.y - 5, 3, 0, Math.PI * 2);
                        this.ctx.arc(enemy.x + 5, enemy.y - 5, 3, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                }
            },
            
            // Desenhar projéteis
            drawProjectiles() {
                // Projéteis do jogador
                for (const proj of this.projectiles) {
                    this.ctx.fillStyle = proj.color;
                    this.ctx.beginPath();
                    this.ctx.arc(proj.x, proj.y, proj.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Rastro
                    this.ctx.globalAlpha = 0.5;
                    this.ctx.beginPath();
                    this.ctx.moveTo(proj.x, proj.y);
                    this.ctx.lineTo(proj.x - proj.dirX * 10, proj.y - proj.dirY * 10);
                    this.ctx.strokeStyle = proj.color;
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                    this.ctx.globalAlpha = 1;
                }
                
                // Projéteis dos inimigos
                for (const proj of this.enemyProjectiles) {
                    this.ctx.fillStyle = proj.color;
                    this.ctx.beginPath();
                    this.ctx.arc(proj.x, proj.y, proj.radius, 0, Math.PI * 2);
                    this.ctx.fill();
                }
            },
            
            // Desenhar itens
            drawItems() {
                for (const item of this.items) {
                    // Item pulsante
                    const pulse = Math.sin(this.gameTime / 200) * 3;
                    
                    this.ctx.fillStyle = item.color;
                    this.ctx.beginPath();
                    this.ctx.arc(item.x, item.y, item.radius + pulse, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    // Contorno
                    this.ctx.strokeStyle = '#FFFFFF';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                    
                    // Símbolo
                    this.ctx.fillStyle = '#FFFFFF';
                    this.ctx.font = '12px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.textBaseline = 'middle';
                    
                    let symbol = '?';
                    switch(item.type) {
                        case 'health': symbol = '♥'; break;
                        case 'damage': symbol = '⚔'; break;
                        case 'speed': symbol = '⚡'; break;
                    }
                    
                    this.ctx.fillText(symbol, item.x, item.y);
                }
            },
            
            // Desenhar partículas
            drawParticles() {
                for (const p of this.particles) {
                    this.ctx.globalAlpha = p.alpha;
                    
                    if (p.type === 'lightning') {
                        // Desenhar relâmpago
                        this.ctx.strokeStyle = p.color;
                        this.ctx.lineWidth = 2;
                        this.ctx.beginPath();
                        this.ctx.moveTo(p.points[0].x, p.points[0].y);
                        
                        for (let i = 1; i < p.points.length; i++) {
                            this.ctx.lineTo(p.points[i].x, p.points[i].y);
                        }
                        
                        this.ctx.stroke();
                    } else if (p.type === 'text') {
                        // Desenhar texto flutuante
                        this.ctx.fillStyle = p.color;
                        this.ctx.font = 'bold 16px Arial';
                        this.ctx.textAlign = 'center';
                        this.ctx.textBaseline = 'middle';
                        this.ctx.fillText(p.text, p.x, p.y);
                    } else {
                        // Desenhar partícula normal
                        this.ctx.fillStyle = p.color;
                        this.ctx.beginPath();
                        this.ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                }
                
                this.ctx.globalAlpha = 1;
            },
            
            // Desenhar HUD
            drawHUD() {
                // Barra de cooldown da habilidade especial
                if (this.player.specialCooldown > 0) {
                    const cooldownPercent = 1 - (this.player.specialCooldown / this.player.specialMaxCooldown);
                    const barWidth = 100;
                    const barHeight = 10;
                    const x = this.canvas.width - barWidth - 20;
                    const y = 80;
                    
                    // Fundo da barra
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    this.ctx.fillRect(x, y, barWidth, barHeight);
                    
                    // Barra de progresso
                    this.ctx.fillStyle = '#FFD166';
                    this.ctx.fillRect(x, y, barWidth * cooldownPercent, barHeight);
                    
                    // Texto
                    this.ctx.fillStyle = '#FFFFFF';
                    this.ctx.font = '12px Arial';
                    this.ctx.textAlign = 'left';
                    this.ctx.textBaseline = 'top';
                    this.ctx.fillText('HABILIDADE ESPECIAL', x, y - 15);
                    
                    // Tempo restante
                    const seconds = Math.ceil(this.player.specialCooldown / 1000);
                    this.ctx.textAlign = 'right';
                    this.ctx.fillText(`${seconds}s`, x + barWidth, y - 15);
                }
                
                // Contador de inimigos restantes
                this.ctx.fillStyle = '#FFFFFF';
                this.ctx.font = '14px Arial';
                this.ctx.textAlign = 'left';
                this.ctx.textBaseline = 'top';
                this.ctx.fillText(`Inimigos: ${this.enemies.length}/${this.enemiesPerWave}`, 20, 80);
                
                // Tempo de jogo
                const minutes = Math.floor(this.gameTime / 60000);
                const seconds = Math.floor((this.gameTime % 60000) / 1000);
                this.ctx.textAlign = 'right';
                this.ctx.fillText(`Tempo: ${minutes}:${seconds.toString().padStart(2, '0')}`, this.canvas.width - 20, 80);
                
                // Pontuação
                this.ctx.fillStyle = '#FFD166';
                this.ctx.font = 'bold 16px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(`Pontos: ${this.score}`, this.canvas.width / 2, 30);
            }
        };
        
        // Inicializar jogo quando a página carregar
        window.addEventListener('load', () => {
            Game.init();
        });
    </script>
</body>
</html>
